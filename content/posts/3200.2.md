---
title: "ğŸ’» CSC3200 LEC3-5 C++è¿›é˜¶"
date: 2025-09-15T18:29:34+08:00
draft: false
summary: "CUHKSZ å¤§äºŒè¯¾ç¨‹ CSC3200 å…³äº C/C++ ä¸­æ•°ç»„ã€æŒ‡é’ˆå’Œæµæ“ä½œ"
categories: 
- SDS
tags: 
- CSC3200
featured_image: "/images/32002.jpg"
---



# CSC3200 LEC 3-4 æ•°ç»„ã€æŒ‡é’ˆã€æµ

<br>

## æ•°ç»„å’ŒæŒ‡é’ˆ

æ•°ç»„å’ŒæŒ‡é’ˆæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ä¸¤è€…æœ‰ç´§å¯†å…³ç³»ï¼Œä¸”è¯­æ³•æœ‰ç›¸äº’å…¼å®¹æ€§ã€‚

<br>

### C é£æ ¼çš„å­—ç¬¦æ•°ç»„

- ä¿ç•™æ–¹æ³•ï¼š`a.c_str()` ä¼šå°†å­—ç¬¦ä¸² a è½¬ä¸º const char*ã€‚å…¶ä½œç”¨ç›¸å½“äº `&a[0]`ã€‚
- å­—ç¬¦ä¸²é•¿åº¦ç”¨ string æˆå‘˜æ–¹æ³• `.size()` æˆ– `.length()` ï¼Œä½œä¸ºæ•°ç»„çš„æŒ‡é’ˆé•¿åº¦ç”¨ `strlen()`ã€‚
- ä½œä¸ºæŒ‡é’ˆï¼Œæ— è®ºæ˜¯å¦ä¸º constï¼Œéƒ½å¯ä»¥è¿›è¡Œ**åç§»æ“ä½œ**ï¼š`s.c_str()[n] â‰¡ s.c_str()+n`ï¼›éƒ½å¯ä»¥è¿›è¡Œ**åç§»é‡è®¡ç®—**ï¼š`s.c_str()[5]-s.c_str[0] == 5`
- è¿™æ˜¯æŒ‡é’ˆä¸æ•°ç»„è¯­æ³•çš„ç›¸äº’å…¼å®¹çš„ç»å…¸ä¾‹å­ã€‚

```cpp
string s = "hello";
s.length();  // 5
cout << boolalpha << (strlen(s.c_str()) == (s.c_str[4]-s.c_str[0])) << '\n';  // True
cout << toupper(s.c_str()[0]);  // 'H'(toupper åªèƒ½å¤„ç†å­—ç¬¦)
```

- **æ³¨æ„ï¼**å¯¹äº string xï¼Œ `&x` çš„ç±»å‹ä¸º `string*`ï¼Œè€Œ `x.c_str()` çš„ç»“æœä¸º `const char*`ï¼Œä¸¤è€…æ— æ³•ç›´æ¥ç›¸äº’èµ‹å€¼ï¼ä»¥ä¸‹æ˜¯ä¸ `x.c_str()` ç±»å‹ç›¸åŒçš„æ“ä½œï¼š

```cpp
char* arr = new char[100];  // å †ä¸Šåˆ†é…ï¼Œæ‰‹åŠ¨é‡Šæ”¾: delete[] arr;
char arr[100];  // æ ˆä¸Šåˆ†é…ï¼Œè‡ªåŠ¨é‡Šæ”¾
```

<br>

### strlen çš„å®šä¹‰

```cpp
int strlen1(char* s){ int n=0; while(s[n] != '\0') n++; return n; }
int strlen2(char* s){ int n=0; while(*s++ != '\0') n++; return n; }
int strlen3(char* s){ char* p=s; while(*p!='\0') ++p; return p - s; } 
```

1ã€n ä½œä¸ºå­—ç¬¦æŒ‡é’ˆæ•°ç»„çš„ç´¢å¼•å’Œè®¡æ•°å™¨ï¼Œè‡ªå¢ç›´åˆ°`\0`ã€‚

2ã€n åªä½œä¸ºè®¡æ•°å™¨ï¼Œ`*(s++)` è®©æŒ‡é’ˆè‡ªå¢ç›´åˆ°æŒ‡å‘`\0`ã€‚

3ã€ä¸ç”¨è®¡æ•°å™¨ï¼Œç›´æ¥è®¡ç®—é¦–å°¾å­—ç¬¦çš„æŒ‡é’ˆåç§»é‡ã€‚

- æŒ‡é’ˆè‡ªå¢ `*p++` çš„å«ä¹‰ç­‰äº `*(p++)` ï¼Œæ˜¯ â€œè¿”å›æŒ‡é’ˆæŒ‡å‘å€¼ï¼Œç„¶åè‡ªå¢æŒ‡é’ˆâ€ï¼š

```cpp
string a = "hello";
const char* p = a.c_str();   // æˆ–è€… char* p = &a[0];
while (*p) {
    cout << *p << '\n';
    p = p + 1;
}
```

- ä»¥ä¸Šä»£ç ç­‰åŒäºä¸‹é¢çš„ä»£ç ï¼š

```cpp
while (*p) {
    cout << *p++ << '\n';   // è¾“å‡ºå½“å‰å­—ç¬¦ï¼ŒæŒ‡é’ˆåŒæ—¶ç§»åŠ¨
}
```

<br>

### æŒ‡é’ˆ"ä½œä¸º"æ•°ç»„

- å¯¹äºå­—ç¬¦ä¸²å£°æ˜æŒ‡é’ˆï¼Œå®ƒä¼šæŒ‡å‘ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸º `ptr[0]`ã€‚
- æŒ‡é’ˆå¯ä»¥ä½œä¸ºæ•°ç»„è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨ä¾‹å­ä¸­ï¼š`*(ptr) â‰¡ ptr[0] â‰¡ 'h'`ã€‚
- ç¬¬ä¸€éƒ¨åˆ†å·²ç»æåˆ°è¿‡ï¼Œ`s.c_str() â‰¡ &s[0] `(éƒ½å±äº const char* ç±»å‹)

```cpp
string s = "hello";
const char* ptr = s.c_str();  // *(ptr+2) == 'l'
```

<br>

### æ•°ç»„"ä½œä¸º"æŒ‡é’ˆ

- æ•°ç»„ååœ¨è¡¨è¾¾å¼ç¯å¢ƒä¼šéšå¼è½¬æˆæŒ‡é’ˆï¼Œå¯ä»¥å½“åšæŒ‡é’ˆä½¿ç”¨ã€‚æ¯”å¦‚ `cstr[]` **è¡°å‡**æˆæŒ‡å‘é¦–å…ƒç´ çš„æŒ‡é’ˆ`&cstr[0]`ï¼Œç±»å‹ä¸º char*ã€‚
- å‰è€…ä½œä¸ºä¸€æ¬¡æ€§åˆ†é…ä¸éœ€è¦ç»è¿‡ Destructorï¼Œåè€…éœ€è¦ã€‚

```cpp
class StringA {
    char cstr[256];   // å›ºå®šæ•°ç»„ï¼Œèµ‹äºˆå¯¹è±¡ä¸€å—å›ºå®šå¤§å°çš„æ ˆç©ºé—´ï¼Œä¸éœ€è¦é¢å¤–åˆ†é…
    char* ptr = cstr;  // åˆæ³•
};
class StringB {
    char* ptr = new char[256];  // åŠ¨æ€åˆ†é…å †ä¸Šçš„ç©ºé—´ï¼Œéœ€è¦æ‰‹åŠ¨åœ°åŠ¨æ€åˆ†é…/é‡Šæ”¾å†…å­˜
};
```
<br>

### æ•°ç»„ä¸ç­‰ä»·äºæŒ‡é’ˆ

- ä½†**æ•°ç»„ â‰  æŒ‡é’ˆ**ã€‚æ•°ç»„åæ˜¯**ä¸å¯ä¿®æ”¹çš„ lvalue**ï¼Œä½ å¯ä»¥æŠŠæ•°ç»„è¡°å‡å**èµ‹ç»™æŒ‡é’ˆ**(1)ï¼Œå´**ä¸èƒ½æŠŠæŒ‡é’ˆèµ‹ ç»™æ•°ç»„**(2)ã€‚
- æ³¨æ„ arr å˜æˆäº†æŒ‡å‘é¦–å…ƒç´ çš„æŒ‡é’ˆï¼Œä½† **&arr çš„ç±»å‹æ˜¯â€œæŒ‡å‘æ•´ä¸ªæ•°ç»„çš„æŒ‡é’ˆâ€**ã€‚
- å¦‚æœ `double arr[5]; double* dp = arr;`ï¼Œæ’ç­‰å¼ï¼š`arr[i] â‰¡ *(arr+i) â‰¡ *(dp+i) â‰¡ dp[i]`ã€‚

```cpp
int arr[4] = {10, 20, 30, 40};
int* ptr = arr;        // åˆæ³•ï¼Œæ•°ç»„åè¡°å‡ä¸º int*    (1)
int  x = arr[2];       // åˆæ³•ï¼Œç­‰ä»·äº *(arr + 2)æˆ–*(ptr + 2)
sizeof(arr);           // 16ï¼ˆ4 ä¸ª int çš„æ€»å­—èŠ‚æ•°ï¼‰
sizeof(ptr);           // 8ï¼ˆåœ¨ 64 ä½æœºä¸ŠæŒ‡é’ˆé€šå¸¸ 8 å­—èŠ‚ï¼‰
arr = ptr;             // âŒ ä¸åˆæ³•ï¼šæ•°ç»„ä¸æ˜¯å¯èµ‹å€¼å¯¹è±¡    (2)
```

- å°æ³¨ï¼šlvalue æ˜¯å¯ä»¥æ”¾åœ¨èµ‹å€¼ç¬¦å· `=` å·¦ä¾§çš„å€¼æˆ–è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼šè§£å¼•ç”¨ `*ptr`ã€å˜é‡`int x `ç­‰ç­‰ã€‚è€Œä¸èƒ½å†™å·¦è¾¹çš„å°±æ˜¯ rvalueï¼Œä¸€èˆ¬æ˜¯ä¸´æ—¶å€¼æˆ–ä¸èƒ½èµ‹å€¼çš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼šå–åœ°å€ `&val`ã€ç®—æœ¯å¼ `x+y-1` ç­‰ç­‰ã€‚

<br>

<br>

## C æ ‡å‡†åº“æ‹·è´å‡½æ•° `strncpy`

<br>

### åœ¨å®ç° String ç±»å®šä¹‰ä¸­çš„ä½¿ç”¨

```cpp
char* strncpy(char* destination, const char* source, std::size_t num);
std::strncpy(this->c_str + this->strlen, other.c_str, copylength);
```
- ä» source æ‹·è´æœ€å¤š num ä¸ªå­—ç¬¦åˆ° destinationã€‚å¦‚æœ source é•¿åº¦å°äº numï¼Œä¼šç”¨ \0 å¡«å……å‰©ä½™ä½ç½®ã€‚
- **å¦‚æœ source é•¿åº¦ â‰¥ numï¼Œåªä¼šæ‹·è´å‰ num ä¸ªå­—ç¬¦ï¼Œä¸ä¼šåœ¨æœ«å°¾è‡ªåŠ¨åŠ  \0ã€‚**
- ä¾‹å­ä¸­å°†å¦ä¸€ä¸ªå­—ç¬¦æ•°ç»„è¿æ¥è‡³å½“å‰æ•°ç»„å (è¿™é‡Œçš„ `this->` éƒ½å¯ä»¥çœç•¥)ã€‚

å®Œæ•´ä¾‹å­æ¯”å¦‚ cpp çš„ String ç±»éœ€è¦å®šä¹‰ operation+= (è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸² â€str1â€œ+â€str2â€œ)ï¼š
```cpp
void string::strcat(string const& other) {  // "cat" whether the append operation will exceed MAXLEN 256
	int total = strlen + other.strlen;
	if (total >= MAXLEN) total = MAXLEN - 1;  // exceeding 255, remaining char WILL be discarded
	int copylen = total - strlen;
	if (copylen > 0) {
		std::strncpy(this->c_str + strlen, other.c_str, copylen);
		strlen = total;
		c_str[strlen] = '\0';  // in case of exceeding
	}
}
// ...... //
string& string::operator+=(string const& other) { strcat(other); return *this; }
```
- ä»£ç æ®µå°†å½“å‰å®ä¾‹ string æœ«å°¾æ¥ä¸Š å¦ä¸€ä¸ªå®ä¾‹ otherï¼Œå»æ‰è¶…å‡ºå†…å­˜éƒ¨åˆ†ï¼Œå¹¶ç¡®ä¿æœ«å°¾æ˜¯ '\0'ï¼Œè¿™æ ·è¿™ä¸ªä»£ç å°±å¯ä»¥è¢«é€’å½’è°ƒç”¨ï¼š
```cpp
str::cout << string(str1) + string(str2) + string(str3) << '\n';
```

<br>

### ç”¨æŒ‡é’ˆè‡ªå¢å®ç° `strncpy`

```cpp
#include <iostream>
using namespace std;

void str_cpy(char* dst, const char* src) {
    while (*dst++ = *src++);
}

int main() {
    char ptr1[] = "Hello";
    char ptr2[100];   // buffered(è¦æœ‰è¶³å¤Ÿç¼“å†²æ ˆ)
    str_cpy(ptr2, ptr1);
    cout << ptr2 << '\n';  // è¾“å‡º Hello
    return 0;
}
```

- æ³¨æ„ while ä¸­å†™çš„ä¸æ˜¯`==` ! æ¡ä»¶ä¸­ä¸æ˜¯åˆ¤åˆ«å¼è€Œæ˜¯åœ¨èµ‹å€¼ï¼Œå…¶ç»“æœä¸ºå½“å‰è¢«èµ‹äºˆç»™ dst[] çš„å­—ç¬¦ï¼Œè€Œéç©ºå­—ç¬¦/å­—ç¬¦ä¸²éƒ½ä¸ºçœŸï¼Œç›´åˆ°é‡åˆ° `\0` (ä¹Ÿå°±æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯ False)æ‰ä¼šç»“æŸå¾ªç¯ã€‚

<br>

<br>

## `<iostream>` ä¸ `<cstdio>`

<br>

### è¾“å‡ºæ—¶ä¿ç•™å°æ•°
- CPP style: setprecision()
```cpp
#include <iostream>
#include <iomanip>
using namespace std;

int main() {
    double d = 3.141592653589793;
    cout << "default + setprecision(2): " << setprecision(2) << d << '\n'; // 3.1ï¼ˆæœ‰æ•ˆæ•°å­—2ä½ï¼‰
    cout << fixed << setprecision(2);
    cout << "fixed + setprecision(2):   " << d << '\n';  // 3.14
    cout << scientific << setprecision(2);
    cout << "scientific + prec(2):     " << d << '\n';  // 3.14e+00
    cout << defaultfloat; // æ¢å¤é»˜è®¤
}
```
- C style: printf()
```cpp
#include <iostream>
#include <cstdio>
using namespace std;
double db = 3.14159265358979323846;
printf("This is a double: %.2f\n", db);  // ç›¸å½“äº fixed
```
(%d æ•´æ•°ï¼Œ%c å­—ç¬¦ï¼Œ%s å­—ç¬¦ä¸²)

```cpp
cout << fixed << setfill('0') << setw(10) << setprecision(4) << left << PI << endl;
```

<br>

<br>

## FileStream

ç”¨äºå‘æ–‡ä»¶è¾“å‡ºæˆ–è€…ä»æ–‡ä»¶æå–ä¿¡æ¯

- ifstreamï¼šé»˜è®¤ `std::ios::in` (åªè¯»æ¨¡å¼)
- outstreamï¼šé»˜è®¤ `std::ios::out | std::ios::trunc` (æ¸…ç©ºå†™å…¥æ¨¡å¼)
- .open(cchar_file, mode)ï¼šæ‰“å¼€æ–‡ä»¶(å’Œæ–¹å¼)
- .get(), .put()ï¼šè¯»å’Œå†™
`<fstream>` ä¸èƒ½å­¦ Python ç›´æ¥å†™â€œcin >> s >> outFile.txt"!!

æµå¤åˆ¶æ–‡ä»¶ï¼š
```cpp
int main() {
    ifstream fin;
    ofstream fout;
    fin.open("infile.txt"); // â€infile.txt".c_str()
    fout.open("outfile.txt", std::ios::out | std::ios::app); // è¿½åŠ å†™å…¥æ¨¡å¼
    char ch;
    while (fin.get(ch)) {   // æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œå¤±è´¥æ—¶ï¼ˆEOFï¼‰é€€å‡º
        fout.put(ch);
    }
    fin.close();
    fout.flush();
    fout.close();
    return 0;
}

```

<br>

<br>

## StringStream

- .strï¼šå°†å­—ç¬¦ä¸²æµä¸­çš„æ•°æ®ä½œä¸ºå­—ç¬¦ä¸²å–å‡º
```cpp
#include <iostream>
#include <string>
#include <sstream>
using namespace std;

int main() {
    int i;
    cin >> i;
    cout << "My favorite number is: " << i << endl;  // Method1
    string s = "My favorite number is: " + to_string(i);  // Method2
    cout << s << endl;

    stringstream ss;  // sstream Method
    ss << "My favorite number is: " << i;
    s = ss.str(); 
    cout << s << endl;
```

<br>

<br>

## å†…å­˜åˆ†é…

- æ‰€æœ‰é€šè¿‡æ–°å¢å¯¹è±¡è¯­æ³•æ–°å»ºçš„æ•°æ® (æ¯”å¦‚ `int* a = cstr`) éƒ½æ˜¯å‚¨å­˜åœ¨æ ˆä¸Šçš„å±€éƒ¨å˜é‡ï¼Œåœ¨å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é”€æ¯ã€‚é€šå¸¸æ¯”å¦‚ main æ–¹æ³•ç»“æŸåé”€æ¯ã€‚
- æ‰€æœ‰é€šè¿‡ `new` å£°æ˜çš„æ–°æ•°æ® (æ¯”å¦‚ `int* a = new int[]`) éƒ½æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„åŠ¨æ€åˆ†é…çš„å˜é‡ï¼Œéœ€è¦åœ¨ç»“æŸç”Ÿå‘½å‘¨æœŸæ—¶æ‰‹åŠ¨ç”¨ `delete / delete[]` é”€æ¯ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä»£ç é‡Œå‡ºç°å¤šå°‘æ¬¡ â€œnew"ï¼Œå°±åº”è¯¥å¯¹åº”å‡ºç°å¤šå°‘æ¬¡ â€deleteâ€œã€‚æ¯”å¦‚ï¼š

```cpp
int* indexArr(int n) {
    int* arr = new int[n];
    for (int i = 0; i < n; i++) arr[i] = i;
    return arr;
}
int main() {
    int* digits = indexArr(10);
    delete[] digits;  // å¿…é¡»é‡Šæ”¾
    return 0;
}
```

<br>

<br>

## const å’Œ static

- `const` çš„ä¸‰ç§ç”¨æ³•ï¼š

```cpp
const double PI = 3.14159;  // æ— è®ºå¦‚ä½•æ— æ³•ä¿®æ”¹è¯¥å˜é‡
void print(const string& s);  // å‡½æ•°ä¸èƒ½ä¿®æ”¹è¯¥å˜é‡
int size() const;  // å‡½æ•°ä¸èƒ½ä¿®æ”¹å¯¹è±¡(å¯¹è±¡çš„æˆå‘˜å˜é‡)
```

- `static`æ˜¯å±äºç±»çš„å…¬ç”¨å˜é‡ï¼Œç”±æ‰€æœ‰å¯¹è±¡å…±äº«ï¼š

```cpp
class MyClass {
public:
    static int count;  // å£°æ˜ä¸€ä¸ªé™æ€å˜é‡
    MyClass() { count++; }
};

int MyClass::count = 0; // å¿…é¡»åœ¨ç±»å¤–å®šä¹‰å¹¶åˆå§‹åŒ–
int main() {
    MyClass a;
    MyClass b;
    cout << MyClass::count << endl; // è¾“å‡º 2
}
```





